<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>test events</title>
		<!--	共用文件，不要修改	start	-->
		<link href="qunit/qunit/qunit.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="../src/base.js"></script>
		<script type="text/javascript" src="qunit/qunit/qunit.js"></script>
		<!--	共用文件，不要修改	end	-->
		<script type="text/javascript">
			/*global ok, console, k, kampfer, test, QUnit*/
			kampfer.require('events');
		</script>
	</head>
	<body>
		<!--	共用文件，不要修改	start	-->
		<h1 id="qunit-header">QUnit for events</h1>
		<h2 id="qunit-banner"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div>
			<div id="parent_fix">
				<div id="child_fix">child</div>
			</div>
		</div>
		<!--	共用文件，不要修改	end	-->

		<script type="text/javascript">
		/*global kampfer, k, ok, test, QUnit, module, window*/
			QUnit.config.reorder = false;
			function $(id) {
				return document.getElementById(id);
			}
			
			test('检查addListener内的data操作', function() {
				var p = document.createElement('p');
					o = {foo:1};

				kampfer.events.addListener(p, ['click', 'focus'], function(event) {});
				kampfer.events.addListener(o, 'click', function() {});

				function checkObj(obj) {
					ok(obj[kampfer.expando], 'check expando');

					var eventsData = kampfer.data.getDataInternal(obj, 'events');
					ok(eventsData, 'check cache object : events');
					ok(eventsData.proxy, 'check events.proxy');
					ok(!kampfer.isEmptyObject(eventsData.listeners), 'events.listeners');
				}

				checkObj(o);
				checkObj(p);
			});

			test('检查addListener对dom操作的有效性', function() {
				var p = document.createElement('p');

				var triggered = [];

				kampfer.events.addListener(p, ['click', 'focus'], function(event) {
					triggered.push(event.type);
				});

				p.click();
				p.focus();

				ok(triggered.join(' ') === 'click focus', 'p click focus');
			});
		</script>
	</body>
</html>