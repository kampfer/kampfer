<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>test data.js</title>
		<!--	共用文件，不要修改	start	-->
		<link href="qunit/qunit/qunit.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="../src/base.js"></script>
		<script type="text/javascript" src="qunit/qunit/qunit.js"></script>
		<!--	共用文件，不要修改	end	-->
		<script type="text/javascript" src="../src/support.js"></script>
		<script type="text/javascript" src="../src/data.js"></script>
	</head>
	<body>
		<!--	共用文件，不要修改	start	-->
		<h1 id="qunit-header">QUnit for test</h1>
		<h2 id="qunit-banner"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		<div id="qunit-fixture">
			test markup, will be hidden
		</div>
		<!--	共用文件，不要修改	end	-->
		<script type="text/javascript">
			test('data.acceptData', function() {
				var obj = {},
					div = document.createElement('div'),
					applet = document.createElement('applet'),
					embed = document.createElement('embed'),
					object = document.createElement('object'),
					flash = document.createElement('object');
				object.setAttribute("classid", "clsid:8AD9C840-044E-11D1-B3E9-00805F499D93");
				flash.setAttribute('classid', 'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000');

				equal(kampfer.data.acceptData(applet), false, '<applet>不能储存cache');
				equal(kampfer.data.acceptData(embed), false, '<embed>不能储存cache');
				equal(kampfer.data.acceptData(object), false, '<object>不能储存cache');
				equal(kampfer.data.acceptData(flash), true, '<object> - flash能储存cache');
				equal(kampfer.data.acceptData(obj), true, '{}能储存cache');
				equal(kampfer.data.acceptData(div), true, '<div>能储存cache');
			});

			test('data.isEmptyDataObj', function() {
				ok(kampfer.data.isEmptyDataObj({}), '空对象');
				ok(!kampfer.data.isEmptyDataObj({foo:1}), '包含属性的对象');
				ok(kampfer.data.isEmptyDataObj({toJSON:function(){}}), '包含方法的对象');
				ok(kampfer.data.isEmptyDataObj({data:{}}), '只包含data属性的对象');
				ok(!kampfer.data.isEmptyDataObj({data:{},foo:1}), '包含属性的对象');
				ok(!kampfer.data.isEmptyDataObj({data:{foo:1}}), 'data属性包含其它属性的对象');
				ok(!kampfer.data.isEmptyDataObj({data:{toJSON:function(){}}}), 'data属性包含方法的对象');
			});

			test('data.hasData', function() {
				var div = document.createElement('div');
				var obj = {};

				ok(!kampfer.data.hasData(div) && !kampfer.data.hasData(obj), '初始状态没有数据cache');

				kampfer.data.setData(div, 'foo', 1);
				kampfer.data.setData(obj, 'foo', 1);

				ok(kampfer.data.hasData(div) && kampfer.data.hasData(obj), '有数据cache');

				kampfer.data.removeData(div, 'foo');
				kampfer.data.removeData(obj, 'foo');

				ok(!kampfer.data.hasData(div) && !kampfer.data.hasData(obj), '删除数据后,没有数据cache');
			});

			function dataTests (elem) {
				var oldCacheLength, dataObj, internalDataObj, expected, actual;

				equal( kampfer.data.getData(elem, "foo"), undefined, "No data exists initially" );
				strictEqual( kampfer.data.hasData(elem), false, "kampfer.data.hasData agrees no data exists initially" );

				equal( typeof kampfer.data.getData(elem), "undefined", "When no data exists, calling kampfer.data.getData with no args return undefined" );

				kampfer.data.setData(elem, 'foo', 'foo');
				dataObj = kampfer.data.getData(elem);
				equal( typeof dataObj, 'object', 'When data exists, calling kampfer.data.getData with no args will return the data object');

				dataObj["foo"] = "bar";
				equal( kampfer.data.getData(elem, "foo"), "bar", "Data is readable by kampfer.data.getData when set directly on a returned data object" );

				strictEqual( kampfer.data.hasData(elem), true, "kampfer.data.hasData agrees data exists when data exists" );

				kampfer.data.setData(elem, "foo", "baz");
				equal( kampfer.data.getData(elem, "foo"), "baz", "Data can be changed by kampfer.data.setData" );
				equal( dataObj["foo"], "baz", "Changes made through kampfer.data.setData propagate to referenced data object" );

				kampfer.data.setData(elem, "foo", undefined);
				equal( kampfer.data.getData(elem, "foo"), "baz", "Data is not unset by passing undefined to kampfer.data.setData" );

				kampfer.data.setData(elem, "foo", null);
				strictEqual( kampfer.data.getData(elem, "foo"), null, "Setting null using kampfer.data.setData works OK" );

				kampfer.data.setData(elem, "foo", "foo1");

				kampfer.data.setData(elem, { "bar" : "baz", "boom" : "bloz" });
				strictEqual( kampfer.data.getData(elem, "foo"), "foo1", "Passing an object extends the data object instead of replacing it" );
				equal( kampfer.data.getData(elem, "boom"), "bloz", "Extending the data object works" );

				kampfer.data.setData(elem, "foo", "foo2", true);
				equal( kampfer.data.getData(elem, "foo", true), "foo2", "Setting internal data works" );
				equal( kampfer.data.getData(elem, "foo"), "foo1", "Setting internal data does not override user data" );

				internalDataObj = kampfer.data.getData( elem, true );
				ok( internalDataObj, "Internal data object exists" );
				notStrictEqual( dataObj, internalDataObj, "Internal data object is not the same as user data object" );

				strictEqual( elem.boom, undefined, "Data is never stored directly on the object" );

				kampfer.data.removeData(elem, "foo");
				strictEqual( kampfer.data.getData(elem, "foo"), undefined, "kampfer.data.removeData removes single properties" );

				kampfer.data.removeData(elem);
				strictEqual( kampfer.data.getData(elem, true), internalDataObj, "kampfer.data.removeData does not remove internal data if it exists" );

				kampfer.data.setData(elem, "foo", "foo1");
				kampfer.data.setData(elem, "foo", "foo2", true);

				equal( kampfer.data.getData(elem, "foo"), "foo1", "(sanity check) Ensure data is set in user data object" );
				equal( kampfer.data.getData(elem, "foo", true), "foo2", "(sanity check) Ensure data is set in internal data object" );

				strictEqual( kampfer.data.getData(elem, kampfer.expando, true), undefined, "Removing the last item in internal data destroys the internal data object" );

				kampfer.data.setData(elem, "foo", "foo2", true);
				equal( kampfer.data.getData(elem, "foo", true), "foo2", "(sanity check) Ensure data is set in internal data object" );

				kampfer.data.removeData(elem, "foo");
				equal( kampfer.data.getData(elem, "foo", true), "foo2", "(sanity check) kampfer.data.removeData for user data does not remove internal data" );
			}

			test('data.setData', function() {
				var div = document.createElement('div');
				var obj = {};

				dataTests(div);
				dataTests(obj);
			});

			test('data.getData', function() {
				ok(true);
			});

			test('data.removeData', function() {
				ok(true);
			});
		</script>
	</body>
</html>
